<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Generic shift register | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Generic shift register | .NET nanoFramework Documentation ">
    

      <link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
      <link rel="manifest" href="../../favicons/site.webmanifest">
      <link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
      <link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#179b88">
      <meta name="msapplication-config" content="../../favicons/browserconfig.xml">
      <meta name="msapplication-TileColor" content="#222222">
      <meta name="theme-color" content="#222222">

      <link rel="stylesheet" href="../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../styles/docfx.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta property="docfx:navrel" content="../../toc.html">
      <meta property="docfx:tocrel" content="../../x-cross/toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="generic-shift-register">Generic shift register</h1>

<p>A shift register enables controlling multiple devices, like LEDs, using a small number of pins (minimum of 3 -- data, data clock and register latch). Shift registers can be daisy-chained without requiring using additional pins, enabling addressing a large number of devices, limited only by current and the algorithms you use.</p>
<p>The <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/ShiftRegister/ShiftRegister.Shared/ShiftRegister.cs">ShiftRegister</a> binding abstracts the interaction with the storage register, the storage clock, the register clock and other shift register capabilities. This binding enables interaction via GPIO or SPI.</p>
<p><a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/ShiftRegister/ShiftRegister.Shared/ShiftRegister.cs">ShiftRegister</a> is used as the base class for <a href="../Sn74hc595/README.html">Sn74hc595</a> and <a href="../Mbi5027/README.html">Mbi5027</a> bindings. It can be used directly, or you can rely on it as an implementation detail of those more specific bindings. It has been tested with with <a href="https://www.ti.com/lit/ds/symlink/sn74hc595.pdf">SN74HC595</a>, <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5027.pdf">MBI5027</a>, and <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5168.pdf">MBI5168</a> shift registers.</p>
<p>The following image is of the popular SN74HC595 8-bit shift register:</p>
<p><img src="https://user-images.githubusercontent.com/2608468/84733283-ac3bca00-af52-11ea-8520-67c91a45c0f0.png" alt="shift-register"></p>
<p>The following image is of the larger MBI5027 16-bit shift register:</p>
<p><img src="https://user-images.githubusercontent.com/2608468/89208974-4216cd00-d572-11ea-98eb-14a9a9b4614f.png" alt="MBI5027"></p>
<p>The <a href="samples">sample</a> demonstrates how to use the shift register in some basic ways.</p>
<h2 id="using-gpio">Using GPIO</h2>
<p>The binding can use <code>GpioController</code> pins to control the shift register. It uses <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/ShiftRegister/ShiftRegister.Shared/ShiftRegisterPinMapping.cs">ShiftRegisterPinMapping</a> to describe the pins that will be used.</p>
<p>The following example code demonstrates how to use a shift register with GPIO.</p>
<pre><code class="lang-csharp">ShiftRegister sr = new(ShiftRegisterPinMapping.Minimal, 8);

// Light up three of first four LEDs
sr.ShiftBit(1);
sr.ShiftBit(1);
sr.ShiftBit(0);
sr.ShiftBit(1);
sr.Latch();

// Display for 1s
Thread.Sleep(1000);

// Write to all 8 registers with a byte value
// ShiftByte latches data by default
sr.ShiftByte(0b_1000_1101);
</code></pre>
<p>The following <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/Sn74hc595/sn74hc595-minimal-led-bar-graph.fzz">diagram</a> demonstrates the required wiring for using the SN74HC595 with minimal mapping. Other shift registers will be similar.</p>
<p><img src="../../devicesimages/Sn74hc595/sn74hc595-minimal-led-bar-graph_bb.png" alt="sn74hc595-led-bar-graph-spi_bb"></p>
<h2 id="using-spi">Using SPI</h2>
<p><strong>Important</strong>: make sure you properly setup the SPI pins especially for ESP32 before creating the <code>SpiDevice</code>, make sure you install the <code>nanoFramework.Hardware.ESP32 nuget</code>:</p>
<pre><code class="lang-csharp">//////////////////////////////////////////////////////////////////////
// when connecting to an ESP32 device, need to configure the SPI GPIOs
// used for the bus
Configuration.SetPinFunction(21, DeviceFunction.SPI1_MOSI);
Configuration.SetPinFunction(22, DeviceFunction.SPI1_MISO);
Configuration.SetPinFunction(23, DeviceFunction.SPI1_CLOCK);
// Make sure as well you are using the right chip select
</code></pre>
<p>For other devices like STM32, please make sure you're using the preset pins for the SPI bus you want to use. The chip select can as well be pre setup.</p>
<p>The bindings can use a <code>SpiDevice</code> to control the shift register. The shift register timing maps to the SPI protocol, enabling SPI to be used. The wiring from is straightforward, from <a href="https://pinout.xyz/pinout/spi">SPI pins</a> to the shift register: SDI (MOSI) -&gt; SDI; SCLK -&gt; CLK; CEO -&gt; LE.</p>
<p>Note: The SPI protocol has terms with <a href="https://hackaday.com/2020/06/29/updating-the-language-of-spi-pin-labels-to-remove-casual-references-to-slavery/">casual references to slavery</a>. We're doing our part to avoid them.</p>
<p>The following example code demonstrates how to use a shift register with SPI.</p>
<pre><code class="lang-csharp">// assuming an 8-bit shift register
ShiftRegister sr = new(SpiDevice.Create(new(1, 42)), 8);

// Light up three of first four LEDs
// The ShiftBit() method is disallowed when using SPI
sr.ShiftByte(0b_1011);

// Clear register
sr.ShiftClear();

// Write to all 8 registers with a byte value
sr.ShiftByte(0b_1010_1010);
</code></pre>
<p>The following <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/Sn74hc595/sn74hc595-led-bar-graph-spi.fzz">diagram</a> demonstrates the required wiring for using the SN74HC595 with SPI. Other shift registers will be similar.</p>
<p><img src="../../devicesimages/Sn74hc595/sn74hc595-led-bar-graph-spi_bb.png" alt="sn74hc595-led-bar-graph-spi_bb"></p>
<h2 id="daisy-chaining">Daisy-chaining</h2>
<p>The binding supports daisy chaining, using either GPIO or SPI. The GPIO-based example below demonstrates how to instantiate the binding for controlling/addressing two -- daisy-chained -- 8-bit shift registers. This is specified by the integer value in the constructor.</p>
<pre><code class="lang-csharp">ShiftRegister sr = new(ShiftRegisterPinMapping.Minimal, 16);
</code></pre>
<p>The shift registers need to be correctly wired to enable daisy-chaining. On the SN74HC595, <code>QH'</code> in the first register would connect to <code>SER</code> in the second register. The pattern with the MBI5027 and MBI5168 is similar, <code>SDO</code> in the first register would connect to <code>SDI</code> in the second.</p>
<p>You can write values across multiple daisy chained devices in one of several ways, as demonstrated in the following code. You wouldn't typically use of all these approaches, but pick one.</p>
<pre><code class="lang-csharp">// Write a value to each register bit and latch
// Only works with GPIO
for (int i = 0; i &lt; sr.BitLength; i++)
{
    sr.ShiftBit(1);
}
sr.Latch();

// Prints the following pattern to each register: 10101010
// This pattern only works for register lengths divisible by 8 (which is common)
for (int i = 0; i &lt; sr.BitLength / 8; i++)
{
    sr.ShiftByte(0b_1010_1010);
}

// Downshift a 32-bit number to the desired number of daisy-chained devices
// Same thing could be done with a 64-bit integer if you have more than four 8-bit shift registers (or more than two 16-bit ones)
// Prints the following pattern across two registers: 0001001110001000
int value = 0b_0001_0011_1000_1000; // 5000
for (int i = (sr.BitLength / 8) - 1; i &gt; 0; i--)
{
    int shift = i * 8;
    int downShiftedValue = value &gt;&gt; shift;
    sr.ShiftByte((byte)downShiftedValue, false);
}

sr.ShiftByte((byte)value);

// Print array of bytes
// Result will be same as previous example
var bytes = new byte[] { 0b10001000, 0b00010011};
foreach (var b in bytes)
{
    sr.ShiftByte(b);
}
</code></pre>
<p>The following <a href="https://github.com/nanoFramework/nanoFramework.IoT.Device/Sn74hc595/sn74hc595-minimal-led-bar-graph-double-up.fzz">diagram</a> demonstrates the required wiring for using the SN74HC595 with daisy-chaining. Other shift registers will be similar. This diagram uses the <code>Minimal</code> mapping. The <code>Complete</code> mapping will differ.</p>
<p><img src="../../devicesimages/Sn74hc595/sn74hc595-minimal-led-bar-graph-double-up_bb.png" alt="sn74hc595-minimal-led-bar-graph-double-up_bb"></p>
<h2 id="resources">Resources</h2>
<ul>
<li>SN74HC595 data sheet: <a href="https://www.ti.com/lit/ds/symlink/sn74hc595.pdf">https://www.ti.com/lit/ds/symlink/sn74hc595.pdf</a></li>
<li>MBI5027 data sheet: <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5027.pdf">http://archive.fairchip.com/pdf/MACROBLOCK/MBI5027.pdf</a></li>
<li>MBI5168 data sheet: <a href="http://archive.fairchip.com/pdf/MACROBLOCK/MBI5168.pdf">http://archive.fairchip.com/pdf/MACROBLOCK/MBI5168.pdf</a></li>
<li>Tutorial: <a href="https://www.youtube.com/watch?v=6fVbJbNPrEU">https://www.youtube.com/watch?v=6fVbJbNPrEU</a></li>
<li>Tutorial: <a href="https://www.youtube.com/watch?v=G1SzTGZ2l1c">https://www.youtube.com/watch?v=G1SzTGZ2l1c</a></li>
</ul>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/devicesdetails/ShiftRegister/README.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Copyright © 2023 nanoFramework Contributors<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
