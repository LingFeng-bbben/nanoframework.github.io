<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Thread execution in nanoFramework | .NET nanoFramework Documentation </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Thread execution in nanoFramework | .NET nanoFramework Documentation ">
    

      <link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
      <link rel="manifest" href="../../favicons/site.webmanifest">
      <link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
      <link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#179b88">
      <meta name="msapplication-config" content="../../favicons/browserconfig.xml">
      <meta name="msapplication-TileColor" content="#222222">
      <meta name="theme-color" content="#222222">

      <link rel="stylesheet" href="../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../styles/docfx.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta property="docfx:navrel" content="../../toc.html">
      <meta property="docfx:tocrel" content="../../x-cross/toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="thread-execution-in-nanoframework">Thread execution in nanoFramework</h1>

<h2 id="about-this-document">About this document</h2>
<p>This document describes how thread execution works with the .NET <strong>nanoFramework</strong> CLR.</p>
<h2 id="introduction-to-threads">Introduction to Threads</h2>
<p>Oversimplifying it a .NET <strong>nanoFramework</strong> thread is (in terms of execution) basically a stream of IL instructions that are translated by the interpreter making things happen.
This execution occurs in a cooperative fashion, meaning that a thread is allowed to run for a certain amount of time, after that it stops and the execution is passed to the next thread that meets the required conditions to run.</p>
<h2 id="thread-execution">Thread execution</h2>
<p>The .NET <strong>nanoFramework</strong> CLR and interpreter run on a RTOS thread. When the RTOS works in a <a href="https://en.wikipedia.org/wiki/Computer_multitasking#Cooperative_multitasking">cooperative</a> fashion (opposed to a <a href="https://en.wikipedia.org/wiki/Computer_multitasking#Preemptive_multitasking">preemptive</a> fashion) the thread is expected to relinquish control to the RTOS so that context switching can occur and the next RTOS thread is given the opportunity to run.
This context switching in .NET <strong>nanoFramework</strong> is expected to occur after each time slot that a .NET <strong>nanoFramework</strong> thread is allowed to run.
It's up to the target board developer to provide the correct way to relinquish the control of the threads execution according to the RTOS running beneath.
This may not be required by all RTOS's. For example when by default the RTOS works in a preemptive fashion, the thread execution occurs in a round robin fashion among the various RTOS threads.</p>
<p>The execution relinquish to the underlying RTOS, so that the 'next' RTOS thread and other RTOS services can run is performed inside the <code>Events_WaitForEvents</code> function that is implemented for each target platform.
For the current version of .NET <strong>nanoFramework</strong> this is accomplished in the following ways:</p>
<ul>
<li>For targets running with ChibiOS (a CMSIS compliant RTOS) a call to <code>osDelay(10)</code> is sufficient and allows the kernel to run all the other threads with the same (or higher) priority.</li>
<li>For the ESP32 target - which is running with FreeRTOS - a call to <code>vTaskDelay(0)</code> is sufficient and allows the kernel to run all the other threads with the same (or higher) priority.</li>
</ul>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/content/architecture/thread-execution.md/#L1" class="contribution-link">Edit this page</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Copyright © 2023 nanoFramework Contributors<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
